# Convenience workflow responsible for adjusting
# Chart.yml 'version' & 'appVersion' fields to the 
# corresponding app:[version-tag]
# and incrementing 'version' field by 1 in the patch section.

# Additionally, helm-docs is run to autogenerate README.md 
# updates and github badges corresponding to new Chart.yml.

# This workflow will uses the github api to get
# latest app release tag information and update 'appVersion' field or 
# will take user input for the appVersion field.
#
# Eg. Chart.yml
#        name: appstore
#        version: 1.7.0    -> 1.7.1 -> 1.7.2
#        appVersion: 2.1.0 -> 2.2.1 -> 3.0.0
#  
#

name: Bump-Chart-Versions
on:
  workflow_dispatch:
    inputs:
      appVersion:
        description: 'Application version for Helm Chart to use. If unset, workflow uses github api to obtain newest version tag.'
        required: false
        type: string
      chartVersion:
        description: 'With every change to the helm chart, the chart version should be incremented. If unset- patch increments by +1.'
        required: false
        type: string
    
jobs:
  build-push-release:
    uses: pchachicho/renci-github-actions/.github/workflows/bump-chart.yml@main
    secrets: inherit